# 部署检查清单 (Deployment Checklist)

> 上次更新: 2026-01-20

## ✅ 已完成

- [x] 代码审查通过
- [x] 全局错误边界
- [x] API Rate Limiting
- [x] 健康检查端点 `/api/health`
- [x] localStorage 隐私模式兼容
- [x] ESLint 错误修复
- [x] 图片域名配置
- [x] TypeScript 类型检查通过
- [x] 构建成功

---

## ⏳ 待完成

### 📸 图片资源

| 文件路径 | 用途 | 优先级 | 状态 |
|----------|------|--------|------|
| `public/images/tng-qr-code.png` | TNG 收款二维码 | **必须** | ❌ 缺失 |
| `public/images/logo.png` | SEO JSON-LD 品牌 Logo | 推荐 | ❌ 缺失 |

### 🔐 环境变量 (生产环境)

| 变量 | 说明 | 状态 |
|------|------|------|
| `DATABASE_URL` | 生产数据库连接 | ⚠️ 需改为生产地址 |
| `NEXTAUTH_SECRET` | 随机密钥 (`openssl rand -base64 32`) | ⚠️ 需生成安全密钥 |
| `AUTH_SECRET` | 与 NEXTAUTH_SECRET 相同 | ⚠️ 需更新 |
| `TWILIO_*` | SMS 发送配置（可选，见通知方案） | 🟡 可选 |
| `VAPID_*` | Web Push 配置（可选） | 🟡 可选 |

---

## 📱 通知方案

### 推荐配置

| 通知渠道 | 用于 | 费用 | 状态 |
|----------|------|------|------|
| **站内通知** | 所有通知 | ✅ 免费 | ✅ 已有 |
| **WhatsApp Business App** | 穿线完成通知 | ✅ 免费 | ⏳ 待配置 |
| **SMS (Twilio)** | OTP 验证码 | 💰 收费 | 🟡 可选 |
| **FCM 推送** | 订单状态 | ✅ 免费 | 🟡 可选 |

### WhatsApp 手动通知方案

**优点**：免费、马来西亚用户习惯、无需开发

**准备工作**：
1. [ ] 买一张专用 SIM 卡
2. [ ] 下载 WhatsApp Business App（不是普通版）
3. [ ] 设置业务资料（名称、地址、营业时间）
4. [ ] 创建快捷回复模板

**快捷回复模板建议**：
```
/完成 → "您好！您的球拍已穿好，可以来取拍了 🏸"
/收到 → "您好！已收到您的球拍，预计明天完成"
/确认 → "收到付款，谢谢！"
/取消 → "您好，您的订单已取消，如有疑问请联系我们"
```

### 🚀 未来功能：WhatsApp 一键通知按钮

在管理后台订单详情页添加 "WhatsApp 通知客户" 按钮：
- 点击后跳转 WhatsApp 并带上预设消息
- 使用 `wa.me/60xxx?text=消息内容` 链接
- 管理员只需按发送

**优先级**：中（上线后根据需要添加）

---

## 🛡️ 可选优化

| 项目 | 说明 | 优先级 |
|------|------|--------|
| WhatsApp 一键通知按钮 | 管理后台快捷发送 | 中 |
| Sentry 集成 | 生产环境错误监控 | 中 |
| FCM 推送通知 | 浏览器推送 | 中 |
| CSRF 保护 | 表单安全增强 | 低 |
| E2E 测试 | Playwright 自动化测试 | 低 |

---

## 📋 部署步骤

1. 上传图片资源到 `public/images/`
2. 生成安全密钥：`openssl rand -base64 32`
3. 更新环境变量（NEXTAUTH_SECRET、AUTH_SECRET、DATABASE_URL）
4. 运行 `npm run build` 确认构建成功
5. 部署到服务器
6. 访问 `/api/health` 确认服务健康

---

## 📞 上线后验证

- [ ] 首页正常加载
- [ ] 用户注册/登录正常
- [ ] TNG 二维码显示正常
- [ ] 预约流程完整
- [ ] 管理后台可访问
- [ ] WhatsApp Business 已设置
