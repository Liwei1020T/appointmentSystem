

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: string_service_app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # 使用 host.docker.internal 连接宿主机的 PostgreSQL
      DATABASE_URL: "postgresql://lwt:system@host.docker.internal:5432/stringSystem"
      NEXTAUTH_URL: "${NEXTAUTH_URL:-http://localhost:3000}"
      NEXTAUTH_SECRET: "${NEXTAUTH_SECRET}"
      NEXT_PUBLIC_APP_URL: "${NEXT_PUBLIC_APP_URL:-http://localhost:3000}"
      NODE_ENV: production
    extra_hosts:
      # macOS/Windows Docker Desktop 自动支持 host.docker.internal
      # Linux 需要这行配置
      - "host.docker.internal:host-gateway"
    volumes:
      # 持久化上传文件
      - ./uploads:/app/uploads
